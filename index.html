<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emily's Cat</title>
  <style>
    /* page */
    html, body { height: 100%; margin: 0; }
    body{
      background:#ffffff;              /* white bg */
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap: 28px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* canvas */
    canvas{
      width:256px; height:256px;       /* 256×256 on screen */
      image-rendering: pixelated;      /* crisp */
      background:#fff;
      border: 1px solid #ddd;
    }

    /* buttons row */
    .button-row{
      display:flex; gap: 28px; justify-content:center; align-items:center;
    }
    .button{
      display:flex; align-items:center; gap:12px;
      padding:14px 22px; font-size:20px; font-weight:600;
      border:2px solid #333; border-radius:10px; background:#fff;
      cursor:pointer; user-select:none;
      transition: transform .05s ease, background .1s ease;
    }
    .button:hover{ background:#f2f2f2; }
    .button:active{ transform: translateY(1px); }
    .button img{ width:28px; height:28px; image-rendering: pixelated; }
  </style>
</head>
<body>

  <!-- Game View -->
  <canvas id="game" width="256" height="256"></canvas>

  <!-- Controls -->
  <div class="button-row">
    <div id="btnKimchi" class="button">
      <img src="Kimchi.png" alt="Kimchi" />
      Kimchi
    </div>
    <div id="btnVodka" class="button">
      <img src="vodka.png" alt="Vodka" />
      Vodka
    </div>
  </div>

  <script>
    // ====== constants ======
    const FRAME_W = 64;        // size of each frame in your sheets
    const FRAME_H = 64;
    const FPS = 8;             // animation speed
    const SCALE = 4;           // 64px * 4 = 256px canvas

    // ====== canvas setup ======
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;

    // center position to draw the 64×64 sprite on a 256×256 canvas
    const drawX = (canvas.width  - FRAME_W * SCALE) / 2;
    const drawY = (canvas.height - FRAME_H * SCALE) / 2;

    // ====== state machine ======
    // files must match your repo EXACTLY (case sensitive)
    const sheets = {
      idle: {
        normal: 'Normalidle.png',
        sick:   'sickidle2.png',
      },
      kimchi: {
        normal: 'normalkimchinormal.png',   // normal → eat kimchi → stay normal
        sick:   'sickkimchinormal.png',     // sick → eat kimchi → heal to normal
      },
      vodka: {
        normal: 'normalvodkasick.png',      // normal → drink → become sick
        sick:   'sickvodkasick.png',        // sick → drink → stay sick
      },
    };

    let mood = 'normal'; // 'normal' | 'sick'
    let playing = null;  // current animation controller (for cancel)

    // generic sprite-sheet player (single row, any frame count)
    function playSheet(src, { loop=false, onComplete=null } = {}){
      // stop previous animation if any
      if (playing && playing.stop) playing.stop();

      const img = new Image();
      const state = {
        frame: 0,
        total: 1,
        tick: 0,
        stopped: false
      };

      img.onload = () => {
        // auto-detect frame count from image width
        state.total = Math.max(1, Math.floor(img.width / FRAME_W));

        const step = () => {
          if (state.stopped) return;

          // draw current frame
          const sx = state.frame * FRAME_W;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(
            img,
            sx, 0, FRAME_W, FRAME_H,      // crop
            drawX, drawY, FRAME_W*SCALE, FRAME_H*SCALE // draw scaled & centered
          );

          // advance at FPS
          state.tick++;
          if (state.tick >= Math.max(1, Math.round(60 / FPS))) {
            state.tick = 0;
            state.frame++;
            if (state.frame >= state.total) {
              if (loop) {
                state.frame = 0;
              } else {
                // finish once, then callback
                if (onComplete) onComplete();
                return; // stop requesting new frames
              }
            }
          }
          state.raf = requestAnimationFrame(step);
        };

        step();
      };

      img.src = src;

      // allow external stop
      playing = {
        stop(){
          state.stopped = true;
          if (state.raf) cancelAnimationFrame(state.raf);
        }
      };
    }

    // helpers to switch to idle based on mood
    function playIdle(){
      playSheet(sheets.idle[mood], { loop:true });
    }

    // button actions
    function doKimchi(){
      // choose sheet by current mood
      const src = sheets.kimchi[mood];
      playSheet(src, {
        loop:false,
        onComplete(){
          // kimchi always ends in normal mood
          mood = 'normal';
          playIdle();
        }
      });
    }

    function doVodka(){
      const src = sheets.vodka[mood];
      playSheet(src, {
        loop:false,
        onComplete(){
          // vodka ends in sick mood
          mood = 'sick';
          playIdle();
        }
      });
    }

    // attach buttons
    document.getElementById('btnKimchi').addEventListener('click', doKimchi);
    document.getElementById('btnVodka').addEventListener('click', doVodka);

    // boot: default normal idle looping
    playIdle();
  </script>
</body>
</html>
  

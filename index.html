<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emily’s Cat</title>
  <style>
    html, body { height:100%; margin:0; }
    body{
      background:#ffffff;               /* white background */
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* canvas box */
    .stage{
      width:256px; height:256px;        /* 4× scale of 64px frames */
      border:1px solid #ddd;
      display:grid; place-items:center;
      background:#fff;
    }
    canvas{
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      width:256px; height:256px;        /* upscale the 64×64 drawing */
      background:#fff;
    }

    /* buttons row */
    .buttons{
      display:flex; gap:28px;
    }
    .buttons button{
      display:flex; align-items:center; gap:14px;
      padding:18px 24px;
      font-size:22px;
      border-radius:10px;
      border:2px solid #333;
      background:#fff;
      cursor:pointer;
      box-shadow:0 1px 0 #999 inset;
      transition: transform .05s ease;
    }
    .buttons button:active{ transform: translateY(1px); }

    .buttons img{
      width:32px; height:32px;          /* small pixel icon */
      image-rendering: pixelated;
    }

    /* tiny helper text (optional) */
    .hint{ color:#999; font-size:12px; }
  </style>
</head>
<body>

  <div class="stage">
    <canvas id="game" width="64" height="64"></canvas>
  </div>

  <div class="buttons">
    <button id="btnKimchi">
      <img src="Kimchi.png" alt="Kimchi">
      Kimchi
    </button>
    <button id="btnVodka">
      <img src="vodka.png" alt="Vodka">
      Vodka
    </button>
  </div>

  <script>
    /* --------- constants --------- */
    const FRAME_W = 64;
    const FRAME_H = 64;
    const FPS = 8;                       // animation speed

    /* --------- spritesheets (from your repo) --------- */
    const SHEETS = {
      idleNormal:       'Normalidle.png',
      idleSick:         'sickidle2.png',
      kimchi_normal:    'normalkimchinormal.png',
      kimchi_sickHeal:  'sickkimchinormal.png',
      vodka_normalSick: 'normalvodkasick.png',
      vodka_sickStay:   'sickvodkasick.png'
    };

    /* --------- state --------- */
    let isSick = false;                  // default normal
    let playingOnce = false;

    /* --------- canvas --------- */
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    /* scale drawing cleanly (we upscale via CSS, but keep nearest-neighbor) */
    ctx.imageSmoothingEnabled = false;

    /* --------- generic animation player --------- */
    const state = {
      img: null,
      frame: 0,
      framesTotal: 1,
      tick: 0,
      ticksPerFrame: Math.max(1, Math.round(60 / FPS)),  // 60fps requestAnimationFrame pacing
      onDone: null
    };

    function loadAndPlay(src, playOnce=false, after=null){
      playingOnce = playOnce;
      state.onDone = after || null;

      const img = new Image();
      img.onload = () => {
        state.img = img;
        state.frame = 0;
        state.tick = 0;
        // auto-detect number of frames by width / 64
        state.framesTotal = Math.max(1, Math.floor(img.width / FRAME_W));
        requestAnimationFrame(loop);
      };
      img.src = src;
    }

    function loop(){
      // advance timing
      state.tick++;
      if (state.tick >= state.ticksPerFrame){
        state.tick = 0;
        state.frame++;
        if (state.frame >= state.framesTotal){
          if (playingOnce){
            // finish one-shot animation
            if (typeof state.onDone === 'function') state.onDone();
            return; // stop drawing until something else plays
          }
          state.frame = 0; // loop idle
        }
      }

      // draw current frame centered
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const sx = state.frame * FRAME_W;
      ctx.drawImage(state.img, sx, 0, FRAME_W, FRAME_H, 0, 0, FRAME_W, FRAME_H);

      requestAnimationFrame(loop);
    }

    /* --------- higher-level helpers --------- */
    function playIdle(){
      loadAndPlay(isSick ? SHEETS.idleSick : SHEETS.idleNormal, false);
    }

    function doKimchi(){
      if (isSick){
        // sick -> heal
        loadAndPlay(SHEETS.kimchi_sickHeal, true, () => {
          isSick = false;
          playIdle();
        });
      } else {
        // normal -> just eat, stay normal
        loadAndPlay(SHEETS.kimchi_normal, true, playIdle);
      }
    }

    function doVodka(){
      if (isSick){
        // sick -> drink, stay sick
        loadAndPlay(SHEETS.vodka_sickStay, true, playIdle);
      } else {
        // normal -> drink, become sick
        loadAndPlay(SHEETS.vodka_normalSick, true, () => {
          isSick = true;
          playIdle();
        });
      }
    }

    /* --------- wire up buttons --------- */
    document.getElementById('btnKimchi').addEventListener('click', doKimchi);
    document.getElementById('btnVodka').addEventListener('click', doVodka);

    /* --------- boot --------- */
    playIdle();
  </script>
</body>
</html>

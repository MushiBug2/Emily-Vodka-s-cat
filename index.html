<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emilyâ€™s Cat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --canvas-size: 640px;   /* 64px frame * 10x scale */
      --gap: 28px;
      --btn-icon: 88px;
      --btn-font: 36px;
    }

    html, body { height: 100%; margin: 0; }
    body{
      background: #ffffff;
      color:#222;
      display: grid;
      place-items: center;
      gap: var(--gap);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Center stack: canvas then buttons */
    .stage{ display:grid; place-items:center; gap: var(--gap); }

    /* Pixel-perfect canvas, no border */
    canvas{
      width: var(--canvas-size);
      height: var(--canvas-size);
      image-rendering: pixelated;
      background: #fff;
    }

    /* Button row */
    .buttons{
      display:flex;
      gap: 56px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Minimal buttons (no boxes) */
    .btn{
      display:inline-flex;
      align-items:center;
      gap:14px;
      background: transparent;
      border: none;
      padding: 6px 8px;
      cursor: pointer;
      font-size: var(--btn-font);
      line-height: 1;
      user-select: none;
    }
    .btn:active { transform: translateY(1px); }

    .btn img{
      width: var(--btn-icon);
      height: var(--btn-icon);
      image-rendering: pixelated;
      display:block;
    }
  </style>
</head>
<body>

  <div class="stage">
    <canvas id="game" width="640" height="640"></canvas>

    <div class="buttons">
      <button id="btnKimchi" class="btn" title="Feed Kimchi">
        <img src="KImchi.png" alt="Kimchi" />
        Kimchi
      </button>

      <button id="btnVodka" class="btn" title="Drink Vodka">
        <img src="vodka.png" alt="Vodka" />
        Vodka
      </button>
    </div>
  </div>

  <script>
    // ---------- CONFIG ----------
    const FRAME_W = 64;        // each frame width (your sprites)
    const FRAME_H = 64;        // each frame height
    const SCALE   = 10;        // 10x bigger
    const FPS     = 6;         // animation speed

    // File names you uploaded (case-sensitive!)
    const SHEETS = {
      idleNormal : 'Normalidle.png',
      kimchiOnce : 'normalkimchinormal.png',
      vodkaOnce  : 'normalvodkasick.png',
      idleSick   : 'sixkidle2.png'
    };

    // ---------- RENDER SETUP ----------
    const canvas = document.getElementById('game');
    const ctx    = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;

    // draw centered helper
    function drawFrame(img, frameIndex){
      const sx = frameIndex * FRAME_W;
      const sy = 0;
      const dw = FRAME_W * SCALE;
      const dh = FRAME_H * SCALE;
      const dx = Math.floor((canvas.width  - dw) / 2);
      const dy = Math.floor((canvas.height - dh) / 2);

      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img, sx, sy, FRAME_W, FRAME_H, dx, dy, dw, dh);
    }

    // ---------- ANIMATION CORE ----------
    let current = {
      img: null,
      frames: 1,
      frame: 0,
      acc: 0,
      playingOnce: false,
      onEnd: null
    };

    const FRAME_TIME = 1000 / FPS;

    function loop(timestamp){
      requestAnimationFrame(loop);
      if(!current.img) return;

      // advance frame timing
      if(!current.prev) current.prev = timestamp;
      const delta = timestamp - current.prev;
      current.prev = timestamp;
      current.acc += delta;

      while(current.acc >= FRAME_TIME){
        current.acc -= FRAME_TIME;
        current.frame++;
        if(current.frame >= current.frames){
          if(current.playingOnce){
            // stop one-shot and call end
            const end = current.onEnd;
            current.playingOnce = false;
            current.onEnd = null;
            if(end) end();
            return; // next loop will draw new state
          }
          current.frame = 0;
        }
      }
      drawFrame(current.img, current.frame);
    }
    requestAnimationFrame(loop);

    // load a sheet and start playing
    function playSheet(src, { once=false, onEnd=null } = {}){
      const img = new Image();
      img.onload = () => {
        current.img = img;
        current.frames = Math.max(1, Math.floor(img.width / FRAME_W));
        current.frame = 0;
        current.acc = 0;
        current.prev = 0;
        current.playingOnce = once;
        current.onEnd = onEnd;
        drawFrame(img, 0);
      };
      img.src = src;
    }

    // ---------- STATE LOGIC ----------
    let state = 'normal';  // 'normal' | 'sick'

    function playIdle(){
      if(state === 'normal'){
        playSheet(SHEETS.idleNormal);
      }else{
        playSheet(SHEETS.idleSick);
      }
    }

    function doKimchi(){
      // play the eat animation once, then go to normal idle
      state = 'normal';
      playSheet(SHEETS.kimchiOnce, { once:true, onEnd: playIdle });
    }

    function doVodka(){
      // play the vodka animation once, then switch to sick idle (loop)
      playSheet(SHEETS.vodkaOnce, {
        once:true,
        onEnd: () => { state = 'sick'; playIdle(); }
      });
    }

    // ---------- HOOK UP BUTTONS ----------
    document.getElementById('btnKimchi').addEventListener('click', doKimchi);
    document.getElementById('btnVodka').addEventListener('click',  doVodka);

    // ---------- BOOT ----------
    playIdle(); // start with normal idle looping
  </script>
</body>
</html>

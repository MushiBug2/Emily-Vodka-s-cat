<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emilyâ€™s Cat</title>
  <style>
    html, body { height:100%; margin:0; }
    body{
      background:#ffffff;               /* white background */
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* canvas box */
    .stage{
      width:256px; height:256px;        
      display:grid; place-items:center;
      background:#fff;
    }
    canvas{
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      width:256px; height:256px;        
      background:#fff;
    }

    /* buttons row */
    .buttons{
      display:flex; gap:28px;
    }
    .buttons button{
      display:flex; align-items:center; gap:14px;
      padding:18px 24px;
      font-size:22px;
      border:none;                      /* remove box */
      background:#fff;
      cursor:pointer;
      transition: transform .05s ease;
    }
    .buttons button:active{ transform: scale(0.97); }

    .buttons img{
      width:32px; height:32px;          
      image-rendering: pixelated;
    }
  </style>
</head>
<body>

  <div class="stage">
    <canvas id="game" width="64" height="64"></canvas>
  </div>

  <div class="buttons">
    <button id="btnKimchi">
      <img src="KImchi.png" alt="Kimchi">
      Kimchi
    </button>
    <button id="btnVodka">
      <img src="vodka.png" alt="Vodka">
      Vodka
    </button>
  </div>

  <script>
    /* --------- constants --------- */
    const FRAME_W = 64;
    const FRAME_H = 64;
    const FPS = 4;                       

    /* --------- spritesheets --------- */
    const SHEETS = {
      idleNormal:       'Normalidle.png',
      idleSick:         'sixkidle2.png',
      kimchi_normal:    'normalkimchinormal.png',
      kimchi_sickHeal:  'sickkimchinormal.png',
      vodka_normalSick: 'normalvodkasick.png',
      vodka_sickStay:   'sickvodkasick.png'
    };

    /* --------- state --------- */
    let isSick = false;                  
    let playingOnce = false;

    /* --------- canvas --------- */
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;

    /* --------- animation state --------- */
    const state = {
      img: null,
      frame: 0,
      framesTotal: 1,
      tick: 0,
      ticksPerFrame: Math.max(1, Math.round(60 / FPS)),
      onDone: null
    };

    function loadAndPlay(src, playOnce=false, after=null){
      playingOnce = playOnce;
      state.onDone = after || null;

      const img = new Image();
      img.onload = () => {
        state.img = img;
        state.frame = 0;
        state.tick = 0;
        state.framesTotal = Math.max(1, Math.floor(img.width / FRAME_W));
        requestAnimationFrame(loop);
      };
      img.src = src;
    }

    function loop(){
      state.tick++;
      if (state.tick >= state.ticksPerFrame){
        state.tick = 0;
        state.frame++;
        if (state.frame >= state.framesTotal){
          if (playingOnce){
            if (typeof state.onDone === 'function') state.onDone();
            return;
          }
          state.frame = 0;
        }
      }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const sx = state.frame * FRAME_W;
      ctx.drawImage(state.img, sx, 0, FRAME_W, FRAME_H, 0, 0, FRAME_W, FRAME_H);
      requestAnimationFrame(loop);
    }

    /* --------- actions --------- */
    function playIdle(){
      loadAndPlay(isSick ? SHEETS.idleSick : SHEETS.idleNormal, false);
    }

    function doKimchi(){
      if (isSick){
        loadAndPlay(SHEETS.kimchi_sickHeal, true, () => {
          isSick = false;
          playIdle();
        });
      } else {
        loadAndPlay(SHEETS.kimchi_normal, true, playIdle);
      }
    }

    function doVodka(){
      if (isSick){
        loadAndPlay(SHEETS.vodka_sickStay, true, playIdle);
      } else {
        loadAndPlay(SHEETS.vodka_normalSick, true, () => {
          isSick = true;
          playIdle();
        });
      }
    }

    /* --------- buttons --------- */
    document.getElementById('btnKimchi').addEventListener('click', doKimchi);
    document.getElementById('btnVodka').addEventListener('click', doVodka);

    /* --------- boot --------- */
    playIdle();
  </script>
</body>
</html>

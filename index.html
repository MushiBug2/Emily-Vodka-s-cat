<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emily’s Cat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --page-bg: #ffffff;     /* white background */
      --canvas-size: 256px;   /* display size (scaled up) */
      --icon-kimchi: 72px;    /* kimchi icon size */
      --icon-vodka: 128px;    /* vodka icon size (bigger) */
      --gap: 24px;
      --text: #222;
    }
    html,body{ height:100%; margin:0; }
    body{
      background: var(--page-bg);
      color: var(--text);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap: var(--gap);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Canvas box (no border) */
    .stage{
      width: var(--canvas-size);
      height: var(--canvas-size);
      display:grid; place-items:center;
    }
    canvas{
      width: 100%; height: 100%;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      background: transparent;
      display:block;
    }

    /* Button row */
    .buttons{ display:flex; align-items:center; gap: 32px; }
    .btn{
      border: none;
      background: transparent;
      display:flex; align-items:center; gap: 12px;
      cursor: pointer;
      font-size: 28px; font-weight: 700; color: var(--text);
      padding: 6px 10px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn img{ image-rendering: pixelated; display:block; height:auto; }
    #imgKimchi{ width: var(--icon-kimchi); }
    #imgVodka { width: var(--icon-vodka); }
  </style>
</head>
<body>

  <!-- Stage -->
  <div class="stage">
    <canvas id="game" width="256" height="256"></canvas>
  </div>

  <!-- Buttons -->
  <div class="buttons">
    <button class="btn" id="btnKimchi" title="Feed kimchi">
      <img id="imgKimchi" src="KImchi.png?v=1" alt="Kimchi">
      Kimchi
    </button>

    <button class="btn" id="btnVodka" title="Give vodka">
      <img id="imgVodka" src="vodka.png?v=1" alt="Vodka">
      Vodka
    </button>
  </div>

  <script>
    // ---------- CONFIG ----------
    const FRAME_W = 64;           // each frame width
    const FRAME_H = 64;           // each frame height
    const FPS      = 3;           // slower = 3 fps (tweak)
    const CENTER_X = 96;          // where to draw the cat (top-left of frame)
    const CENTER_Y = 96;          // adjust to taste

    // Sprite sheets (EDIT FILENAMES + frame counts to your exact files)
    const SHEETS = {
      idle:     { src: 'Normalidle.png?v=2',         frames: 4 }, // default loop
      kimchi:   { src: 'normalkimchinormal.png?v=2', frames: 6 }, // eat once
      vodka:    { src: 'normalvodkasick.png?v=2',    frames: 6 }, // drink once
      sickIdle: { src: 'sixkidle2.png?v=2',          frames: 4 }  // sick loop
    };

    // ---------- SETUP ----------
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    let isSick = false;

    // state for current animation
    let current = {
      img: new Image(),
      sheet: SHEETS.idle,
      frame: 0,
      timer: 0,
      msPerFrame: 1000 / FPS,
      looping: true,
      playingOnce: false,
      onFinish: null
    };

    function loadSheet(sheet, { loop=true, once=false, onFinish=null } = {}){
      current.sheet = sheet;
      current.frame = 0;
      current.timer = 0;
      current.looping = loop;
      current.playingOnce = once;
      current.onFinish = onFinish;
      current.img = new Image();
      current.img.onload = () => { /* will render in loop */ };
      current.img.src = sheet.src;
    }

    function drawFrame(){
      const sx = current.frame * FRAME_W;
      const sy = 0;
      ctx.clearRect(0,0,canvas.width, canvas.height);
      // draw centered-ish
      ctx.drawImage(
        current.img,
        sx, sy, FRAME_W, FRAME_H,
        CENTER_X, CENTER_Y, FRAME_W, FRAME_H
      );
    }

    let last = performance.now();
    function loop(now){
      const dt = now - last;
      last = now;
      current.timer += dt;

      // advance frames by time
      while(current.timer >= current.msPerFrame){
        current.timer -= current.msPerFrame;
        current.frame++;

        if(current.frame >= current.sheet.frames){
          if(current.playingOnce){
            // end one-shot
            if (typeof current.onFinish === 'function') current.onFinish();
            // stop advancing until next loadSheet sets up again
            current.playingOnce = false;
            current.looping = false;
            current.frame = current.sheet.frames - 1;
          }else if(current.looping){
            current.frame = 0;
          }
        }
      }

      drawFrame();
      requestAnimationFrame(loop);
    }

    // ---------- ACTIONS ----------
    function playIdleNormal(){
      loadSheet(SHEETS.idle, { loop:true });
      isSick = false;
    }
    function playIdleSick(){
      loadSheet(SHEETS.sickIdle, { loop:true });
      isSick = true;
    }

    function doKimchi(){
      // Eat once; when done → healthy idle
      loadSheet(SHEETS.kimchi, {
        loop:false,
        once:true,
        onFinish: () => playIdleNormal()
      });
    }

    function doVodka(){
      // Drink once; when done → sick idle
      loadSheet(SHEETS.vodka, {
        loop:false,
        once:true,
        onFinish: () => playIdleSick()
      });
    }

    // ---------- WIRE BUTTONS ----------
    document.getElementById('btnKimchi').addEventListener('click', doKimchi);
    document.getElementById('btnVodka').addEventListener('click', doVodka);

    // ---------- BOOT ----------
    playIdleNormal();            // start with healthy idle loop
    requestAnimationFrame(loop); // start render loop
  </script>
</body>
</html>

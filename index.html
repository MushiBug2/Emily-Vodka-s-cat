<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emily's Cat</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body{
      background:#ffffff;                /* white background */
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap: 24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Canvas centered, no border box */
    #game {
      image-rendering: pixelated;
      background:#fff;
      width: 256px; height: 256px;       /* scale the 64x64 frames 4x */
    }

    /* Button row */
    .button-row{
      display:flex; justify-content:center; gap: 24px;
    }

    /* Image buttons (no box look) */
    .imgbtn{
      display:flex; align-items:center; gap: 12px;
      padding: 10px 18px;
      font-size: 22px; font-weight: 700;
      color:#222; background: transparent;
      border: none; outline: none;
      cursor: pointer;
    }
    .imgbtn img{
      width: 28px; height: 28px; image-rendering: pixelated;
    }
    .imgbtn:active{ transform: translateY(1px); }
  </style>
</head>
<body>

  <!-- Game canvas -->
  <canvas id="game" width="64" height="64"></canvas>

  <!-- Buttons with your static images -->
  <div class="button-row">
    <button id="btnKimchi" class="imgbtn">
      <img src="Klmchi.png" alt="Kimchi" />
      Kimchi
    </button>
    <button id="btnVodka" class="imgbtn">
      <img src="vodka.png" alt="Vodka" />
      Vodka
    </button>
  </div>

<script>
/* ---------- CONFIG (adjust frames if needed) ---------- */
const FRAME_W = 64;      // sprite frame width
const FRAME_H = 64;      // sprite frame height
const FPS      = 8;      // animation speed (lower = slower)

/* Sprite sheets & frame counts.
   Update `frames` if your exports have different lengths. */
const SHEETS = {
  idle:               { src: 'Normalidle.png',        frames: 4  },
  sickIdle:           { src: 'sixkidle2.png',         frames: 4  },
  normalKimchi:       { src: 'normalkimchinormal.png',frames: 8  },
  sickKimchi:         { src: 'sickkimchinormal.png',  frames: 8  },
  normalVodka:        { src: 'normalvodkasick.png',   frames: 8  },
  sickVodka:          { src: 'sickvodkasick.png',     frames: 8  }
};

/* ---------- RENDER SETUP ---------- */
const canvas = document.getElementById('game');
const ctx    = canvas.getContext('2d');

let state = {
  img: new Image(),
  sheet: null,
  frame: 0,
  tick: 0,
  ticksPerFrame: Math.max(1, Math.floor(60 / FPS)),
  playingOnce: false,        // true = play sheet once then switch
  nextSheet: null,
  sick: false                // health state
};

function loadSheet(key, playOnce=false, thenKey=null){
  const s = SHEETS[key];
  if(!s) return;

  state.sheet = { key, ...s };
  state.playingOnce = playOnce;
  state.nextSheet = thenKey || null;
  state.frame = 0;
  state.tick  = 0;

  const img = new Image();
  img.onload = () => { state.img = img; };
  img.src = s.src;
}

function loop(){
  requestAnimationFrame(loop);

  // advance frames
  if (++state.tick >= state.ticksPerFrame){
    state.tick = 0;
    state.frame++;
    if (state.frame >= state.sheet.frames){
      if (state.playingOnce){
        // jump to the requested next animation
        const next = state.nextSheet || (state.sick ? 'sickIdle' : 'idle');
        loadSheet(next, false);
      } else {
        state.frame = 0; // loop
      }
    }
  }

  // clear & draw current frame
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const sx = state.frame * FRAME_W;
  ctx.drawImage(state.img, sx, 0, FRAME_W, FRAME_H, 0, 0, FRAME_W, FRAME_H);
}

/* ---------- BUTTON BEHAVIOR ---------- */
function doKimchi(){
  // play kimchi animation depending on health, then switch to NORMAL idle
  if (state.sick){
    loadSheet('sickKimchi', true, 'idle');
  } else {
    loadSheet('normalKimchi', true, 'idle');
  }
  state.sick = false; // heals
}

function doVodka(){
  // play vodka animation depending on health, then switch to SICK idle
  if (state.sick){
    loadSheet('sickVodka', true, 'sickIdle');
  } else {
    loadSheet('normalVodka', true, 'sickIdle');
  }
  state.sick = true; // becomes/remains sick
}

/* ---------- BOOT ---------- */
document.getElementById('btnKimchi').addEventListener('click', doKimchi);
document.getElementById('btnVodka').addEventListener('click', doVodka);

// start default normal idle
loadSheet('idle', false);
loop();
</script>
</body>
</html>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Emily’s Cat</title>
  <style>
    html, body { height:100%; margin:0; }
    body{
      background:#ffffff;                    /* white background */
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:28px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Canvas */
    canvas{
      image-rendering: pixelated;
      background:#fff;
      width:256px; height:256px;             /* CSS size */
    }

    /* Buttons row */
    .buttons{ display:flex; gap:24px; }

    /* Minimal, no boxes */
    .btn{
      display:flex; align-items:center; gap:12px;
      background:transparent; border:none; padding:0;
      color:#111; font-size:28px; cursor:pointer;
      user-select:none;
    }
    .btn img{ image-rendering: pixelated; display:block; }

    /* icon sizes (vodka 5x kimchi) */
    .icon-kimchi{ width:40px; height:auto; }
    .icon-vodka { width:200px; height:auto; } /* ~5× */
  </style>
</head>
<body>

  <!-- Game area -->
  <canvas id="game" width="256" height="256" aria-label="Emily's cat"></canvas>

  <!-- Buttons -->
  <div class="buttons">
    <button id="btnKimchi" class="btn" title="Kimchi">
      <img class="icon-kimchi" src="KImchi.png" alt="Kimchi">
      Kimchi
    </button>

    <button id="btnVodka" class="btn" title="Vodka">
      <img class="icon-vodka" src="vodka.png" alt="Vodka">
      Vodka
    </button>
  </div>

  <script>
    // ====== settings ======
    const FRAME_W = 64, FRAME_H = 64;    // each frame size
    const FPS = 4;                       // slower animation
    const CANVAS_SIZE = 256;             // canvas is 256x256
    const SCALE = CANVAS_SIZE / FRAME_W; // 4x scale
    // ======================

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d', { alpha: false });
    ctx.imageSmoothingEnabled = false;

    // Sprite sheets (auto-calc frames from image width)
    const SHEETS = {
      idle:           { src: 'NormalIdle.png' },              // default loop
      sickIdle:       { src: 'sixkidle2.png' },               // sick loop
      kimchi:         { src: 'normalkimchinormal.png', once:true, heal:true },
      vodka:          { src: 'normalvodkasick.png',  once:true, makeSick:true }
    };

    // simple image cache
    const cache = new Map();
    function getImg(src){
      return new Promise((resolve, reject)=>{
        if (cache.has(src)) return resolve(cache.get(src));
        const img = new Image();
        img.onload = ()=>{ cache.set(src, img); resolve(img); };
        img.onerror = reject;
        img.src = src;
      });
    }

    // state
    let baseline = 'idle';      // 'idle' or 'sickIdle'
    let current  = null;        // currently playing sheet key
    let frame = 0;
    let totalFrames = 1;
    let lastTime = 0;
    let playingOnce = false;
    let img = null;

    async function play(key){
      current = key;
      const sheet = SHEETS[key];
      img = await getImg(sheet.src);
      totalFrames = Math.max(1, Math.floor(img.width / FRAME_W)); // auto-detect
      frame = 0;
      playingOnce = !!sheet.once;
    }

    function setHealthy(){ baseline = 'idle'; }
    function setSick(){ baseline = 'sickIdle'; }

    async function doKimchi(){
      await play('kimchi');
      // on finish -> healthy idle
      onFinish = ()=>{ setHealthy(); play(baseline); };
    }

    async function doVodka(){
      await play('vodka');
      // on finish -> sick idle
      onFinish = ()=>{ setSick(); play(baseline); };
    }

    // draw loop with FPS throttle
    let onFinish = null;
    function loop(ts){
      requestAnimationFrame(loop);

      if (!img) return;

      // throttle to FPS
      if (ts - lastTime < 1000 / FPS) return;
      lastTime = ts;

      // clear
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // source frame rect
      const sx = frame * FRAME_W;
      const sy = 0;

      // dest centered
      const dx = Math.floor((canvas.width  - FRAME_W * SCALE) / 2);
      const dy = Math.floor((canvas.height - FRAME_H * SCALE) / 2);

      ctx.drawImage(
        img,
        sx, sy, FRAME_W, FRAME_H,
        dx, dy, FRAME_W * SCALE, FRAME_H * SCALE
      );

      frame++;

      if (frame >= totalFrames) {
        if (playingOnce) {
          playingOnce = false;
          // finish the one-shot, then go baseline
          if (typeof onFinish === 'function') { const f = onFinish; onFinish = null; f(); }
        } else {
          frame = 0; // loop
        }
      }
    }

    // wire buttons
    document.getElementById('btnKimchi').addEventListener('click', doKimchi);
    document.getElementById('btnVodka').addEventListener('click', doVodka);

    // boot: start normal idle loop
    (async () => {
      await play(baseline);
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
